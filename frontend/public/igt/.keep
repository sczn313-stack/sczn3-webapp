 <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IGT Test Upload (Find Route)</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin: 16px; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end; }
    label { display:block; font-size: 13px; opacity: .8; margin-bottom: 6px; }
    input[type="text"] { width: 520px; max-width: 100%; padding: 10px; font-size: 14px; }
    input[type="file"] { padding: 8px 0; }
    button { padding: 10px 14px; font-size: 15px; cursor: pointer; }
    .card { border:1px solid #ddd; border-radius:10px; padding:12px; margin-top:14px; }
    pre { background:#0b1020; color:#d6e1ff; padding:12px; border-radius:10px; overflow:auto; max-height: 55vh; }
    .muted { opacity:.75; }
  </style>
</head>
<body>
  <h2>IGT Test Upload — Route Finder</h2>

  <div class="card">
    <div class="row">
      <div>
        <label>Backend Base URL (paste your backend Render URL here)</label>
        <input id="baseUrl" type="text" placeholder="https://your-backend.onrender.com" />
        <div class="muted" style="margin-top:6px;">
          If you don’t know it, open Render → your Web Service → copy the URL.
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:14px;">
      <div>
        <label>Pick a test target image (PNG/JPG)</label>
        <input id="file" type="file" accept="image/*" />
      </div>
      <div>
        <button id="runBtn">Upload (Auto-find route)</button>
      </div>
    </div>

    <div class="muted" style="margin-top:10px;">
      This tries common endpoints: /analyze, /api/analyze, /upload, /api/upload, /score, /api/score
    </div>
  </div>

  <div class="card">
    <div><b>Status:</b> <span id="statusText">Idle</span></div>
    <div class="muted" id="hint" style="margin-top:6px;"></div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Response</h3>
    <pre id="out">{}</pre>
  </div>

<script>
const statusText = document.getElementById("statusText");
const hint = document.getElementById("hint");
const out = document.getElementById("out");

function setStatus(msg, extra="") {
  statusText.textContent = msg;
  hint.textContent = extra || "";
}

function joinUrl(base, path) {
  base = base.replace(/\/+$/, "");
  path = path.startsWith("/") ? path : ("/" + path);
  return base + path;
}

async function tryEndpoint(url, file) {
  const form = new FormData();
  form.append("file", file);
  form.append("debug", "1");
  const res = await fetch(url, { method:"POST", body: form });
  const ct = res.headers.get("content-type") || "";
  const bodyText = await res.text().catch(()=>"");
  return { ok: res.ok, status: res.status, statusText: res.statusText, ct, bodyText };
}

document.getElementById("runBtn").addEventListener("click", async () => {
  const base = document.getElementById("baseUrl").value.trim();
  const fileInput = document.getElementById("file");

  if (!base) { setStatus("Paste your backend URL first.", "Example: https://sczn3-sec-backend-144.onrender.com"); return; }
  if (!fileInput.files || !fileInput.files[0]) { setStatus("Pick a file first.", "Choose one of the IGT_TEST_*.png images."); return; }

  const file = fileInput.files[0];

  const candidates = ["/analyze","/api/analyze","/upload","/api/upload","/score","/api/score"];
  setStatus("Uploading…", "Trying endpoints: " + candidates.join(", "));

  for (const p of candidates) {
    const url = joinUrl(base, p);
    try {
      setStatus("Trying " + p + " …", url);
      const r = await tryEndpoint(url, file);

      if (r.ct.includes("application/json")) {
        let parsed;
        try { parsed = JSON.parse(r.bodyText); } catch(e) { parsed = r.bodyText; }
        out.textContent = JSON.stringify({ endpoint: p, status: r.status, data: parsed }, null, 2);
        setStatus("Found working endpoint: " + p, "Now we can wire the real page to this route.");
        return;
      }

      if (r.ok) {
        out.textContent = JSON.stringify({ endpoint: p, status: r.status, data: r.bodyText }, null, 2);
        setStatus("Endpoint responded OK (non-JSON): " + p, "If you expected JSON, backend may be returning HTML/text.");
        return;
      }
    } catch (e) {
      // keep trying next endpoint
    }
  }

  setStatus("No working endpoint found.", "Backend may require a different field name than 'file', or CORS is blocking.");
  out.textContent = "Tried: " + candidates.join(", ");
});
</script>
</body>
</html>
